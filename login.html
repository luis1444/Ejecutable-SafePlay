<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iniciar sesión — SafePlay</title>
  <style>
    :root{
      --sky-100:#e0f2fe; --sky-200:#bae6fd; --sky-300:#7dd3fc; --sky-400:#38bdf8; --sky-500:#0ea5e9;
      --ink:#2c3e50; --muted:#5a6c7d; --danger:#ef4444; --radius:16px; --shadow:0 10px 30px rgba(2,132,199,.18);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color:var(--ink);
      min-height:100vh; background: linear-gradient(135deg, #87CEEB 0%, #ffffff 100%);
      display:grid; place-items:center; padding:48px 16px;
    }
    .card{
      width:min(460px, 96vw); background:#fff; border:1px solid var(--sky-200); border-radius:20px;
      box-shadow: var(--shadow); padding:28px;
    }
    .logo{display:flex; justify-content:center; margin-bottom:16px}
    h1{font-size:1.6rem; text-align:center; margin-bottom:8px}
    .sub{color:var(--muted); text-align:center; margin-bottom:20px}
    .field{display:grid; gap:8px; margin:12px 0}
    .field label{font-weight:700}
    .input{
      border:2px solid var(--sky-200); border-radius:12px; padding:12px 14px; font-size:1rem;
      outline:none; transition:.2s;
    }
    .input:focus{border-color:var(--sky-400); box-shadow:0 0 0 6px rgba(56,189,248,.12)}
    .btn{
      width:100%; padding:12px 16px; border:none; border-radius:12px; font-weight:800; cursor:pointer;
      background:linear-gradient(45deg, #38bdf8, #0284c7); color:white; box-shadow:0 6px 15px rgba(56,189,248,.35);
      margin-top:10px; transition:transform .15s ease, box-shadow .3s ease;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 12px 25px rgba(56,189,248,.45)}
    .err{color:#7f1d1d; background:#fee2e2; border:1px solid #fecaca; padding:10px 12px; border-radius:12px; margin-top:10px; display:none}
    .hint{font-size:.9rem; color:var(--muted); margin-top:8px; text-align:center}
  </style>
</head>
<body>
<div class="card">
  <div class="logo">
    <img src="assets/safeplaylogo.png" alt="SafePlay" style="width:180px;height:auto"/>
  </div>
  <h1>Inicia sesión</h1>
  <p class="sub">Solo supervisores registrados en la web pueden acceder.</p>

  <div class="field">
    <label for="email">Correo</label>
    <input id="email" class="input" type="email" placeholder="supervisor@safeplay.dev" autocomplete="username"/>
  </div>
  <div class="field">
    <label for="password">Contraseña</label>
    <input id="password" class="input" type="password" placeholder="••••••••" autocomplete="current-password"/>
  </div>

  <button id="loginBtn" class="btn">Entrar</button>
  <div id="errorBox" class="err"></div>
</div>

<script>
  const { ipcRenderer } = require('electron');

  const email = document.getElementById('email');
  const password = document.getElementById('password');
  const errorBox = document.getElementById('errorBox');
  const btn = document.getElementById('loginBtn');

  function showError(msg){
    errorBox.textContent = msg;
    errorBox.style.display = 'block';
  }

  btn.addEventListener('click', async () => {
    errorBox.style.display = 'none';
    const e = email.value.trim();
    const p = password.value;

    if (!e || !p) return showError('Completa correo y contraseña.');
    btn.disabled = true; btn.textContent = 'Verificando…';

    try {
      const res = await ipcRenderer.invoke('auth:login', { email: e, password: p });
      if (res?.ok) {
        // Pasar al panel principal (tu index.html)
        window.location = 'index.html';
      } else {
        showError(res?.message || 'No se pudo iniciar sesión.');
      }
    } catch (err) {
      showError(err?.message || 'Error de autenticación');
    } finally {
      btn.disabled = false; btn.textContent = 'Entrar';
    }
  });

  // Autologin si ya hay sesión
  (async () => {
    const s = await ipcRenderer.invoke('auth:getSession');
    if (s?.ok) window.location = 'index.html';
  })();
</script>
</body>
</html>
